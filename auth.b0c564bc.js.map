{"mappings":"qhBAAA,IAAAA,EAAAC,EAAA,SAEAC,EAAAF,GAASG,OAAOC,KAAK,CACnBC,SAAU,gBACVC,SAAU,QACVC,QAAS,K,WCLX,IAAAC,EAAAP,EAAA,S,aAGA,MAAMQ,EAAa,kBAEZ,MAAMC,EACXC,kBAAkBC,GAChBA,EAAKC,SAAWH,GAAKI,EAASF,EAAKC,UAE/BD,EAAKG,OAASH,EAAKI,OAASJ,EAAKC,SACnCI,EAAAC,UAAUC,WAAWV,EAAYG,GAEjCQ,QAAQC,IAAI,aAAcT,EAE9B,CAEAD,qBAAqBI,GACnB,MACMH,SADcF,EAAKY,YACNC,MAAKC,GAAMA,EAAGT,QAAUA,IAE3C,OADA,EAAAP,EAAAiB,UAAS,OAAQb,GACVA,CACT,CAEAD,wBACE,IACE,MAAMe,QAAcT,EAAAC,UAAUS,YAAYlB,GAE1C,OADA,EAAAD,EAAAiB,UAAS,QAASC,GACXA,CAIT,CAHE,MAAOE,GAEP,OADAR,QAAQC,IAAIO,GACL,EACT,CACF,CAEAjB,wBAAwBI,EAAOF,GAC7B,QAAIH,EAAKmB,kBAAkBd,EAAOF,MAChC,EAAAL,EAAAiB,UAAS,gBAAgB,IAClB,EAIX,CAEAd,yBAAyBI,GAGvB,cAFoBL,EAAKY,YACJQ,MAAKN,GAAMA,EAAGT,QAAUA,GAE/C,CAEAJ,+BAA+BI,EAAOF,GACpC,IACE,MAAMD,QAAaF,EAAKqB,QAAQhB,GAChC,IAAKH,EAAM,MAAM,IAAIoB,MAAM,YAM3B,OAJItB,GAAKI,EAASD,KAAcD,EAAKC,WACnC,EAAAL,EAAAiB,UAAS,OAAQb,GAGZF,GAAKI,EAASD,KAAcD,EAAKC,QAI1C,CAHE,MAAOe,GAEP,OADAR,QAAQC,IAAIO,EAAIK,UACT,CACT,CACF,CAEAtB,SAAgBuB,GACd,OAAO,EAAA1B,EAAA2B,QAAOD,EAChB,E,aC9DmBE,SAASC,cAAc,iBAE/BC,iBAAiB,UAAUC,MAAMC,IAC5CA,EAAEC,iBACF,MAAM1B,EAAQyB,EAAEE,cAAcC,SAAS5B,MAAM6B,MACvC/B,EAAW2B,EAAEE,cAAcC,SAAS9B,SAAS+B,MFF9C,IAAmBX,QEIAvB,EAAKmB,kBAAkBd,EAAOF,IAGpDH,EAAKmC,WAAW9B,EAAOF,IACvB,EAAAL,EAAAsC,cFRsBb,EEUZ,oCFTZ/B,EAAAF,GAASG,OAAO4C,QAAQd,GESZ","sources":["src/modules/notiflix.js","src/modules/auth/index.js","src/scripts/pages-scripts/auth.js"],"sourcesContent":["import Notiflix from 'notiflix';\n\nNotiflix.Notify.init({\n  position: 'center-bottom',\n  distance: '130px',\n  opacity: 0.8,\n});\n\nexport function showError(message) {\n  Notiflix.Notify.failure(message);\n}\n","import { loadFromLS, saveToLS, sha256 } from '../../scripts/helpers';\nimport { DynamoAPI } from '../database/dynamodb';\n\nconst TABLE_NAME = 'GameStore-users';\n\nexport class Auth {\n  static createUser(user) {\n    user.password = Auth.#convert(user.password);\n\n    if (user.login && user.email && user.password) {\n      DynamoAPI.createItem(TABLE_NAME, user);\n    } else {\n      console.log('Error user', user);\n    }\n  }\n\n  static async getUser(login) {\n    const users = await Auth.getUsers();\n    const user = users.find(el => el.login === login);\n    saveToLS('user', user);\n    return user;\n  }\n\n  static async getUsers() {\n    try {\n      const users = await DynamoAPI.getAllItems(TABLE_NAME);\n      saveToLS('users', users);\n      return users;\n    } catch (err) {\n      console.log(err);\n      return [];\n    }\n  }\n\n  static async authorized(login, password) {\n    if (Auth.isCorrectPassword(login, password)) {\n      saveToLS('isAuthorized', true);\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  static async isFreeLogin(login) {\n    const users = await Auth.getUsers();\n    const isFree = users.some(el => el.login === login);\n    return !isFree;\n  }\n\n  static async isCorrectPassword(login, password) {\n    try {\n      const user = await Auth.getUser(login);\n      if (!user) throw new Error('Not User');\n\n      if (Auth.#convert(password) === user.password) {\n        saveToLS('user', user);\n      }\n\n      return Auth.#convert(password) === user.password;\n    } catch (err) {\n      console.log(err.message);\n      return false;\n    }\n  }\n\n  static #convert(text) {\n    return sha256(text);\n  }\n}\n","import { showError } from '../../modules/notiflix';\nimport { HOST } from '../constants';\nimport { Auth } from '../../modules/auth';\nimport { redirect } from '../helpers';\n\nconst authFormElem = document.querySelector('.js-auth-form');\n\nauthFormElem.addEventListener('submit', async e => {\n  e.preventDefault();\n  const login = e.currentTarget.elements.login.value;\n  const password = e.currentTarget.elements.password.value;\n\n  const isCorrect = await Auth.isCorrectPassword(login, password);\n\n  if (isCorrect) {\n    Auth.authorized(login, password);\n    redirect();\n  } else {\n    showError('Login or Password is not correct!');\n  }\n});\n"],"names":["$19McP","parcelRequire","$parcel$interopDefault","Notify","init","position","distance","opacity","$fDHq9","$1a94b3211beae20f$var$TABLE_NAME","$1a94b3211beae20f$export$334c29725a78c21d","static","user","password","convert","login","email","$3JKSU","DynamoAPI","createItem","console","log","getUsers","find","el","saveToLS","users","getAllItems","err","isCorrectPassword","some","getUser","Error","message","text","sha256","document","querySelector","addEventListener","async","e","preventDefault","currentTarget","elements","value","authorized","redirect","failure"],"version":3,"file":"auth.b0c564bc.js.map"}